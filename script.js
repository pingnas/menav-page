window.MeNav={version:"1.0.0",getConfig:function(){const e=document.getElementById("menav-config-data");return e?JSON.parse(e.textContent):null},_getElementId:function(e){const t=e.getAttribute("data-type");return"nav-item"===t?e.getAttribute("data-id"):"social-link"===t?e.getAttribute("data-url"):e.getAttribute("data-name")},_findElement:function(e,t){let n;return n="nav-item"===e?`[data-type="${e}"][data-id="${t}"]`:"social-link"===e?`[data-type="${e}"][data-url="${t}"]`:`[data-type="${e}"][data-name="${t}"]`,document.querySelector(n)},updateElement:function(e,t,n){const i=this._findElement(e,t);if(!i)return!1;if("site"===e){if(n.url&&(i.href=n.url,i.setAttribute("data-url",n.url)),n.name&&(i.querySelector("h3").textContent=n.name,i.setAttribute("data-name",n.name)),n.description&&(i.querySelector("p").textContent=n.description,i.setAttribute("data-description",n.description)),n.icon){const e=i.querySelector("i");e&&(e.className=n.icon),i.setAttribute("data-icon",n.icon)}return n.title&&(i.title=n.title),this.events.emit("elementUpdated",{id:t,type:"site",data:n}),!0}if("category"===e){if(n.name){const e=i.querySelector("h2");if(e){const t=e.querySelector("i"),i=t?t.className:"";e.innerHTML=`<i class="${n.icon||i}"></i> ${n.name}`}i.setAttribute("data-name",n.name)}return n.icon&&i.setAttribute("data-icon",n.icon),this.events.emit("elementUpdated",{id:t,type:"category",data:n}),!0}if("nav-item"===e){if(n.name){const e=i.querySelector(".nav-text");e&&(e.textContent=n.name),i.setAttribute("data-name",n.name)}if(n.icon){const e=i.querySelector("i");e&&(e.className=n.icon),i.setAttribute("data-icon",n.icon)}return this.events.emit("elementUpdated",{id:t,type:"nav-item",data:n}),!0}if("social-link"===e){if(n.url&&(i.href=n.url,i.setAttribute("data-url",n.url)),n.name){const e=i.querySelector(".nav-text");e&&(e.textContent=n.name),i.setAttribute("data-name",n.name)}if(n.icon){const e=i.querySelector("i");e&&(e.className=n.icon),i.setAttribute("data-icon",n.icon)}return this.events.emit("elementUpdated",{id:t,type:"social-link",data:n}),!0}return!1},addElement:function(e,t,n){let i;if("site"===e){if(i=document.querySelector(`[data-type="category"][data-name="${t}"]`),!i)return null;const e=i.querySelector('[data-container="sites"]');if(!e)return null;const a=document.createElement("a");a.className="site-card",a.href=n.url||"#",a.title=n.name+(n.description?" - "+n.description:""),a.setAttribute("data-type","site"),a.setAttribute("data-name",n.name||"未命名站点"),a.setAttribute("data-url",n.url||""),a.setAttribute("data-icon",n.icon||"fas fa-link"),a.setAttribute("data-description",n.description||""),a.innerHTML=`\n                <i class="${n.icon||"fas fa-link"}"></i>\n                <h3>${n.name||"未命名站点"}</h3>\n                <p>${n.description||""}</p>\n            `,e.appendChild(a);const s=e.querySelector(".empty-sites");return s&&s.remove(),this.events.emit("elementAdded",{id:n.name,type:"site",parentId:t,data:n}),n.name}if("category"===e){if(i=document.querySelector('[data-container="categories"]'),!i)return null;const e=document.createElement("section");return e.className="category",e.setAttribute("data-type","category"),e.setAttribute("data-name",n.name||"未命名分类"),e.setAttribute("data-icon",n.icon||"fas fa-folder"),e.setAttribute("data-container","categories"),e.innerHTML=`\n                <h2 data-editable="category-name"><i class="${n.icon||"fas fa-folder"}"></i> ${n.name||"未命名分类"}</h2>\n                <div class="sites-grid" data-container="sites">\n                    <p class="empty-sites">暂无网站</p>\n                </div>\n            `,i.appendChild(e),this.events.emit("elementAdded",{id:n.name,type:"category",data:n}),n.name}return null},removeElement:function(e,t){const n=this._findElement(e,t);if(!n)return!1;let i=null;if("site"===e){const e=n.closest('[data-type="category"]');e&&(i=e.getAttribute("data-name"))}return n.remove(),this.events.emit("elementRemoved",{id:t,type:e,parentId:i}),!0},getAllElements:function(e){return Array.from(document.querySelectorAll(`[data-type="${e}"]`)).map(t=>({id:this._getElementId(t),type:e,element:t}))},events:{listeners:{},on:function(e,t){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),this},emit:function(e,t){return this.listeners[e]&&this.listeners[e].forEach(e=>e(t)),this},off:function(e,t){return this.listeners[e]&&(t?this.listeners[e]=this.listeners[e].filter(e=>e!==t):delete this.listeners[e]),this}}},document.addEventListener("DOMContentLoaded",()=>{let e,t=!1,n="home",i=!0,a=!1,s=!1,r=!1,o=!1,c="local",l={initialized:!1,items:[]};const d={local:{name:"本地搜索",icon:"fas fa-search",url:null},google:{name:"Google搜索",icon:"fab fa-google",url:"https://www.google.com/search?q="},bing:{name:"Bing搜索",icon:"fab fa-microsoft",url:"https://www.bing.com/search?q="},baidu:{name:"百度搜索",icon:"fas fa-paw",url:"https://www.baidu.com/s?wd="}},u=document.getElementById("search"),m=document.querySelector(".search-box"),h=document.getElementById("search-results"),g=h.querySelectorAll(".search-section"),f=document.querySelector(".search-icon"),p=document.querySelector(".search-engine-dropdown"),y=document.querySelectorAll(".search-engine-option"),v=document.querySelector(".menu-toggle"),L=document.querySelector(".search-toggle"),E=document.querySelector(".sidebar"),b=document.querySelector(".search-container"),q=document.querySelector(".overlay"),C=document.querySelector(".sidebar-toggle"),S=document.querySelector(".content"),A=document.querySelector(".theme-toggle"),x=A.querySelector("i"),w=document.querySelector(".scroll-progress");function k(){if(!l.initialized){l.items=[];try{e||(e=document.querySelectorAll(".page")),e.forEach(e=>{if("search-results"===e.id)return;const t=e.id;e.querySelectorAll(".site-card").forEach(e=>{try{const n=e.querySelector(".item-title")?.textContent?.toLowerCase()||"",i=e.querySelector(".item-desc")?.textContent?.toLowerCase()||"",a=e.href||e.getAttribute("href")||"#",s=e.querySelector("i")?.className||"";l.items.push({pageId:t,title:n,description:i,url:a,icon:s,element:e,searchText:(n+" "+i).toLowerCase()})}catch(e){console.error("Error processing card:",e)}})}),l.initialized=!0}catch(e){console.error("Error initializing search index:",e),l.initialized=!0}}}function I(){a=!a,E.classList.toggle("active",a),q.classList.toggle("active",a),s&&$()}function $(){s=!s,b.classList.toggle("active",s),q.classList.toggle("active",s),s&&(u.focus(),a&&I())}function N(){a&&I(),s&&$()}function T(){return window.innerWidth<=768}function M(){const e=(S.scrollTop||0)/(S.scrollHeight-S.clientHeight||1)*100;w.style.width=e+"%"}function H(t,a=!1){(n!==t||a||i)&&(n=t,requestAnimationFrame(()=>{e||(e=document.querySelectorAll(".page")),e.forEach(e=>{const n=e.id===t;n!==e.classList.contains("active")&&e.classList.toggle("active",n)}),i&&(i=!1,document.body.classList.add("loaded"))}),S.scrollTop=0,M(),a||(u.value="",R()))}function z(i){if(l.initialized||k(),i=i.toLowerCase().trim()){t||(t=!0);try{const t=new Map;let a=!1;const s=l.items.filter(e=>e.searchText.includes(i)||PinyinMatch.match(e.searchText,i));s.forEach(e=>{t.has(e.pageId)||t.set(e.pageId,[]),t.get(e.pageId).push(e.element.cloneNode(!0)),a=!0}),requestAnimationFrame(()=>{try{g.forEach(e=>{try{const t=e.querySelector(".sites-grid");t&&(t.innerHTML=""),e.style.display="none"}catch(e){console.error("Error clearing search section")}}),t.forEach((e,t)=>{const n=h.querySelector(`[data-section="${t}"]`);if(n)try{const t=n.querySelector(".sites-grid");if(t){const a=document.createDocumentFragment();e.forEach(e=>{!function(e,t){if(!e||!t)return;try{const n=e.querySelector(".item-title"),i=e.querySelector(".item-desc");if(!n||!i)return;if(n.textContent.toLowerCase().includes(t)){const e=n.textContent,i=new RegExp(`(${P(t)})`,"gi"),a=document.createDocumentFragment();let s,r=0;const o=new RegExp(i);for(;null!==(s=o.exec(e));){s.index>r&&a.appendChild(document.createTextNode(e.substring(r,s.index)));const t=document.createElement("span");if(t.className="highlight",t.textContent=s[0],a.appendChild(t),r=s.index+s[0].length,0===o.lastIndex)break}for(r<e.length&&a.appendChild(document.createTextNode(e.substring(r)));n.firstChild;)n.removeChild(n.firstChild);n.appendChild(a)}else if(PinyinMatch.match(n.textContent,t)){const e=PinyinMatch.match(n.textContent,t),[i,a]=e;n.innerHTML=n.textContent.slice(0,i)+`<span class="highlight">${n.textContent.slice(i,a+1)}</span>`+n.textContent.slice(a+1)}if(i.textContent.toLowerCase().includes(t)){const e=i.textContent,n=new RegExp(`(${P(t)})`,"gi"),a=document.createDocumentFragment();let s,r=0;const o=new RegExp(n);for(;null!==(s=o.exec(e));){s.index>r&&a.appendChild(document.createTextNode(e.substring(r,s.index)));const t=document.createElement("span");if(t.className="highlight",t.textContent=s[0],a.appendChild(t),r=s.index+s[0].length,0===o.lastIndex)break}for(r<e.length&&a.appendChild(document.createTextNode(e.substring(r)));i.firstChild;)i.removeChild(i.firstChild);i.appendChild(a)}else if(PinyinMatch.match(i.textContent,t)){const e=PinyinMatch.match(i.textContent,t),[n,a]=e;i.innerHTML=i.textContent.slice(0,n)+`<span class="highlight">${i.textContent.slice(n,a+1)}</span>`+i.textContent.slice(a+1)}}catch(e){console.error("Error highlighting search term")}}(e,i),a.appendChild(e)}),t.appendChild(a),n.style.display="block"}}catch(e){console.error("Error updating search results grid")}});const r=h.querySelector(".subtitle");r&&(r.textContent=a?`在所有页面中找到 ${s.length} 个匹配项`:"未找到匹配的结果"),"search-results"!==n&&(n="search-results",e.forEach(e=>{e.classList.toggle("active","search-results"===e.id)})),m.classList.toggle("has-results",a),m.classList.toggle("no-results",!a)}catch(e){console.error("Error updating search UI")}})}catch(e){console.error("Error performing search")}}else R()}function P(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function R(){if(t){t=!1;try{requestAnimationFrame(()=>{try{g.forEach(e=>{try{const t=e.querySelector(".sites-grid");if(t)for(;t.firstChild;)t.removeChild(t.firstChild);e.style.display="none"}catch(e){console.error("Error clearing search section")}}),m.classList.remove("has-results","no-results");const t=document.querySelector(".nav-item.active");if(t){const i=t.getAttribute("data-page");i&&n!==i&&(n=i,e.forEach(e=>{e.classList.toggle("active",e.id===i)}))}else n="home",e.forEach(e=>{e.classList.toggle("active","home"===e.id)})}catch(e){console.error("Error resetting search UI")}})}catch(e){console.error("Error in resetSearch")}}}document.documentElement.classList.remove("preload"),document.documentElement.classList.contains("theme-preload")&&(document.documentElement.classList.remove("theme-preload"),document.body.classList.add("light-theme"),r=!0),document.documentElement.classList.contains("sidebar-collapsed-preload")&&(document.documentElement.classList.remove("sidebar-collapsed-preload"),E.classList.add("collapsed"),S.classList.add("expanded"),o=!0),document.body.classList.remove("loading"),document.body.classList.add("loaded"),C&&C.addEventListener("click",function(){o=!o,requestAnimationFrame(()=>{E.classList.toggle("collapsed",o),S.classList.toggle("expanded",o),localStorage.setItem("sidebarCollapsed",o?"true":"false")})}),A.addEventListener("click",function(){r=!r,document.body.classList.toggle("light-theme",r),r?(x.classList.remove("fa-moon"),x.classList.add("fa-sun")):(x.classList.remove("fa-sun"),x.classList.add("fa-moon")),localStorage.setItem("theme",r?"light":"dark")}),v.addEventListener("click",I),L.addEventListener("click",$),q.addEventListener("click",N),window.addEventListener("resize",()=>{T()?(E.classList.remove("collapsed"),S.classList.remove("expanded")):(E.classList.remove("active"),b.classList.remove("active"),q.classList.remove("active"),a=!1,s=!1),M()}),S.addEventListener("scroll",M),M();const B=((e,t)=>{let n=null;return(...i)=>{n&&clearTimeout(n),n=setTimeout(()=>{e.apply(this,i),n=null},t)}})(z,300);function D(){if(y.forEach(e=>{e.classList.remove("active"),e.getAttribute("data-engine")===c&&e.classList.add("active")}),f){const e=f.className.split(" ").filter(e=>"search-icon"===e);f.className=e.join(" ");const t=d[c];if(t){t.icon.split(" ").forEach(e=>{f.classList.add(e)}),f.setAttribute("title",t.name)}}}u.addEventListener("input",e=>{"local"===c?B(e.target.value):t&&R()}),u.addEventListener("keyup",e=>{"Escape"===e.key?(u.value="",R()):"Enter"===e.key&&(!function(e){if(e.trim())if("local"===c)z(e);else{const t=d[c];t&&t.url&&window.open(t.url+encodeURIComponent(e),"_blank")}}(u.value),T()&&s&&N())}),u.addEventListener("keydown",e=>{"Enter"===e.key&&e.preventDefault()}),window.addEventListener("load",()=>{document.querySelectorAll(".site-card");const n=document.querySelectorAll(".category"),i=document.querySelectorAll(".nav-item"),s=document.querySelectorAll(".nav-item-wrapper"),l=document.querySelectorAll(".submenu-item");e=document.querySelectorAll(".page"),"light"===localStorage.getItem("theme")?(r=!0,x.classList.remove("fa-moon"),x.classList.add("fa-sun")):(r=!1,x.classList.remove("fa-sun"),x.classList.add("fa-moon")),function(){const e=localStorage.getItem("sidebarCollapsed");o="true"===e&&!T()}(),function(){const e=localStorage.getItem("searchEngine");e&&d[e]&&(c=e),D(),f.addEventListener("click",e=>{e.stopPropagation(),p.classList.toggle("active")}),y.forEach(e=>{e.getAttribute("data-engine")===c&&e.classList.add("active"),e.addEventListener("click",n=>{n.stopPropagation();const i=e.getAttribute("data-engine");i&&d[i]&&(c!==i&&t&&R(),c=i,localStorage.setItem("searchEngine",i),D(),p.classList.remove("active"))})}),document.addEventListener("click",()=>{p.classList.remove("active")})}();try{const e=window.MeNav.getConfig();e&&e.version&&(window.MeNav.version=e.version,console.log("MeNav API initialized with version:",e.version))}catch(e){console.error("Error initializing MeNav API:",e)}H("home"),n.forEach((e,t)=>{setTimeout(()=>{e.style.opacity="1"},100*t)});const u=document.querySelector(".nav-item.active");if(u){u.closest(".nav-item-wrapper")}i.forEach(e=>{e.addEventListener("click",t=>{if("_blank"===e.getAttribute("target"))return;t.preventDefault();const n=e.closest(".nav-item-wrapper"),r=n&&n.querySelector(".submenu");r&&(e.classList.contains("active")?n.classList.toggle("expanded"):(s.forEach(e=>{e!==n&&e.classList.remove("expanded")}),n.classList.add("expanded"))),l.forEach(e=>{e.classList.remove("active")}),i.forEach(t=>{t.classList.toggle("active",t===e)});const o=e.getAttribute("data-page");o&&(H(o),T()&&a&&!r&&N())})}),l.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.getAttribute("data-page"),s=e.getAttribute("data-category");n&&(l.forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),i.forEach(e=>{e.classList.toggle("active",e.getAttribute("data-page")===n)}),H(n),setTimeout(()=>{const e=document.getElementById(n);if(e){const t=Array.from(e.querySelectorAll(".category h2")).find(e=>e.textContent.trim().includes(s));if(t)try{const e=document.querySelector(".content");if(e&&e.scrollHeight>e.clientHeight){const n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),a=i.height/4,s=e.scrollTop+n.top-i.top-a;e.scrollTo({top:s,behavior:"smooth"})}else t.scrollIntoView({behavior:"smooth",block:"center"})}catch(e){console.error("Error during scroll:",e),t.scrollIntoView({behavior:"smooth",block:"center"})}}},25),T()&&a&&N())})}),"requestIdleCallback"in window?requestIdleCallback(()=>k()):setTimeout(k,1e3)})});